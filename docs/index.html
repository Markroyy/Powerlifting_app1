<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Powerlifting App</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React, ReactDOM, Babel CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Recharts CDN -->
  <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
  <!-- Lucide React CDN -->
  <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
  <div id="root"></div>
  <script type="text/babel">
    // Use global variables instead of ES6 imports for browser compatibility
    const { useState, useCallback } = React;
    const { Download, Calculator, Dumbbell, TrendingUp } = LucideReact;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

    const PowerliftingApp = () => {
      // Mike Tuchscherer's RPE Chart (RPE to percentage at different rep ranges)
      const tuchschererChart = {
        1: { 6: 0.86, 7: 0.89, 8: 0.92, 9: 0.96, 10: 1.0 },
        2: { 6: 0.84, 7: 0.87, 8: 0.90, 9: 0.94, 10: 0.97 },
        3: { 6: 0.81, 7: 0.84, 8: 0.88, 9: 0.91, 10: 0.94 },
        4: { 6: 0.79, 7: 0.82, 8: 0.85, 9: 0.89, 10: 0.92 },
        5: { 6: 0.77, 7: 0.80, 8: 0.83, 9: 0.86, 10: 0.89 },
        6: { 6: 0.75, 7: 0.78, 8: 0.81, 9: 0.84, 10: 0.87 },
        7: { 6: 0.73, 7: 0.76, 8: 0.79, 9: 0.82, 10: 0.85 },
        8: { 6: 0.71, 7: 0.74, 8: 0.77, 9: 0.80, 10: 0.83 },
        9: { 6: 0.69, 7: 0.72, 8: 0.75, 9: 0.78, 10: 0.81 },
        10: { 6: 0.67, 7: 0.70, 8: 0.73, 9: 0.76, 10: 0.79 }
      };

      // Create initial training data with calculated weights
      const createInitialData = () => {
        const baseData = {
          squat: {
            currentMax: 140,
            weeks: [
              { week: 1, topSingle: { rpe: 6, actualReps: 1, actualRpe: 6 }, backoff: { sets: 3, reps: 5, rpe: 6, actualReps: 5, actualRpe: 6 }, notes: '' },
              { week: 2, topSingle: { rpe: 7, actualReps: 1, actualRpe: 7 }, backoff: { sets: 3, reps: 4, rpe: 7, actualReps: 4, actualRpe: 7 }, notes: '' },
              { week: 3, topSingle: { rpe: 8, actualReps: 1, actualRpe: 8 }, backoff: { sets: 3, reps: 3, rpe: 8, actualReps: 3, actualRpe: 8 }, notes: '' },
              { week: 4, topSingle: { rpe: 9, actualReps: 1, actualRpe: 9 }, backoff: { sets: 3, reps: 3, rpe: 9, actualReps: 3, actualRpe: 9 }, notes: '' }
            ]
          },
          bench: {
            currentMax: 100,
            weeks: [
              { week: 1, topSingle: { rpe: 6, actualReps: 1, actualRpe: 6 }, backoff: { sets: 3, reps: 5, rpe: 6, actualReps: 5, actualRpe: 6 }, notes: '' },
              { week: 2, topSingle: { rpe: 7, actualReps: 1, actualRpe: 7 }, backoff: { sets: 3, reps: 4, rpe: 7, actualReps: 4, actualRpe: 7 }, notes: '' },
              { week: 3, topSingle: { rpe: 8, actualReps: 1, actualRpe: 8 }, backoff: { sets: 3, reps: 3, rpe: 8, actualReps: 3, actualRpe: 8 }, notes: '' },
              { week: 4, topSingle: { rpe: 9, actualReps: 1, actualRpe: 9 }, backoff: { sets: 3, reps: 3, rpe: 9, actualReps: 3, actualRpe: 9 }, notes: '' }
            ]
          },
          deadlift: {
            currentMax: 180,
            weeks: [
              { week: 1, topSingle: { rpe: 6, actualReps: 1, actualRpe: 6 }, backoff: { sets: 3, reps: 5, rpe: 6, actualReps: 5, actualRpe: 6 }, notes: '' },
              { week: 2, topSingle: { rpe: 7, actualReps: 1, actualRpe: 7 }, backoff: { sets: 3, reps: 4, rpe: 7, actualReps: 4, actualRpe: 7 }, notes: '' },
              { week: 3, topSingle: { rpe: 8, actualReps: 1, actualRpe: 8 }, backoff: { sets: 3, reps: 3, rpe: 8, actualReps: 3, actualRpe: 8 }, notes: '' },
              { week: 4, topSingle: { rpe: 9, actualReps: 1, actualRpe: 9 }, backoff: { sets: 3, reps: 3, rpe: 9, actualReps: 3, actualRpe: 9 }, notes: '' }
            ]
          }
        };

        // Auto-calculate initial weights for all lifts
        Object.keys(baseData).forEach(lift => {
          const currentMax = baseData[lift].currentMax;
          baseData[lift].weeks = baseData[lift].weeks.map(week => ({
            ...week,
            topSingle: {
              ...week.topSingle,
              weight: Math.round((currentMax * tuchschererChart[1][week.topSingle.rpe]) / 2.5) * 2.5
            },
            backoff: {
              ...week.backoff,
              weight: Math.round((currentMax * tuchschererChart[week.backoff.reps][week.backoff.rpe]) / 2.5) * 2.5
            }
          }));
        });

        return baseData;
      };

      const initialData = createInitialData();

      const [trainingData, setTrainingData] = useState(initialData);
      const [selectedLift, setSelectedLift] = useState('squat');
      const [currentBlock, setCurrentBlock] = useState(1);
      const [completedBlocks, setCompletedBlocks] = useState([]);
      const [activeTab, setActiveTab] = useState('training');

      // Deload detection system
      const analyzeDeloadNeed = useCallback(() => {
        const analysis = {
          needsDeload: false,
          severity: 'none', // 'none', 'mild', 'moderate', 'severe'
          reasons: [],
          suggestions: [],
          affectedLifts: []
        };

        ['squat', 'bench', 'deadlift'].forEach(lift => {
          const weeks = trainingData[lift].weeks;
          const recentPerformance = [];
          
          // Collect recent RPE data
          weeks.forEach((week, weekIndex) => {
            if (week.topSingle.weight && week.topSingle.actualRpe) {
              recentPerformance.push({
                week: weekIndex + 1,
                targetRPE: week.topSingle.rpe,
                actualRPE: week.topSingle.actualRpe,
                variance: week.topSingle.actualRpe - week.topSingle.rpe,
                weight: week.topSingle.weight
              });
            }
            if (week.backoff.weight && week.backoff.actualRpe) {
              recentPerformance.push({
                week: weekIndex + 1,
                targetRPE: week.backoff.rpe,
                actualRPE: week.backoff.actualRpe,
                variance: week.backoff.actualRpe - week.backoff.rpe,
                weight: week.backoff.weight,
                type: 'backoff'
              });
            }
          });

          if (recentPerformance.length >= 2) {
            const avgVariance = recentPerformance.reduce((sum, p) => sum + p.variance, 0) / recentPerformance.length;
            const recentVariance = recentPerformance.slice(-3).reduce((sum, p) => sum + p.variance, 0) / Math.min(3, recentPerformance.slice(-3).length);
            
            // Check for consistent RPE overshoot
            const consistentOvershoot = recentPerformance.slice(-2).every(p => p.variance > 0.5);
            const highVariance = avgVariance > 0.7;
            const veryHighVariance = avgVariance > 1.2;
            const escalatingRPEs = recentVariance > avgVariance + 0.3;

            if (veryHighVariance) {
              analysis.needsDeload = true;
              analysis.severity = 'severe';
              analysis.reasons.push(`${lift.charAt(0).toUpperCase() + lift.slice(1)} RPEs averaging +${avgVariance.toFixed(1)} above target`);
              analysis.affectedLifts.push(lift);
            } else if (highVariance && consistentOvershoot) {
              analysis.needsDeload = true;
              if (analysis.severity === 'none') analysis.severity = 'moderate';
              analysis.reasons.push(`${lift.charAt(0).toUpperCase() + lift.slice(1)} consistently overshooting RPE targets`);
              analysis.affectedLifts.push(lift);
            } else if (escalatingRPEs && avgVariance > 0.4) {
              analysis.needsDeload = true;
              if (analysis.severity === 'none') analysis.severity = 'mild';
              analysis.reasons.push(`${lift.charAt(0).toUpperCase() + lift.slice(1)} showing signs of accumulating fatigue`);
              analysis.affectedLifts.push(lift);
            }
          }
        });

        // Generate suggestions based on severity
        if (analysis.needsDeload) {
          switch (analysis.severity) {
            case 'severe':
              analysis.suggestions = [
                'Take a full deload week (50-60% of current weights)',
                'Reduce volume by 50% for all lifts',
                'Focus on technique and mobility work',
                'Consider taking 2-3 complete rest days'
              ];
              break;
            case 'moderate':
              analysis.suggestions = [
                'Deload affected lifts to 70% of current weights',
                'Reduce volume by 30-40%',
                'Maintain accessory work but reduce intensity',
                'Prioritize sleep and recovery'
              ];
              break;
            case 'mild':
              analysis.suggestions = [
                'Reduce intensity by 10-15% for 1 week',
                'Keep same weights but aim for RPE 7-8 instead of 8-9',
                'Add an extra rest day this week',
                'Monitor closely - full deload if RPEs don\'t improve'
              ];
              break;
          }
        }

        return analysis;
      }, [trainingData]);

      const deloadAnalysis = analyzeDeloadNeed();

      // Calculate weight based on current max and RPE using Tuchscherer chart
      const calculateWeight = useCallback((currentMax, rpe, reps = 1) => {
        const repData = tuchschererChart[Math.min(reps, 10)];
        if (!repData) return 0;
        
        const percentage = repData[rpe];
        if (!percentage) return 0;
        
        const calculatedWeight = currentMax * percentage;
        return Math.round(calculatedWeight / 2.5) * 2.5;
      }, []);

      // Calculate estimated 1RM using Tuchscherer RPE chart
      const calculateEstimated1RM = useCallback((weight, reps, rpe) => {
        if (!weight || !reps || !rpe) return 0;
        
        const repData = tuchschererChart[Math.min(reps, 10)];
        if (!repData) return 0;
        
        const percentage = repData[rpe];
        if (!percentage) return 0;
        
        const estimated1RM = weight / percentage;
        return Math.round(estimated1RM / 2.5) * 2.5;
      }, []);

      // Calculate backoff weight based on estimated 1RM from top single
      const calculateBackoffWeight = useCallback((topSingleWeight, topSingleReps, topSingleRpe, backoffReps, backoffRpe) => {
        if (!topSingleWeight || !topSingleReps || !topSingleRpe) return 0;
        
        const estimated1RM = calculateEstimated1RM(topSingleWeight, topSingleReps, topSingleRpe);
        return calculateWeight(estimated1RM, backoffRpe, backoffReps);
      }, [calculateEstimated1RM, calculateWeight]);

      const calculateWeeklyEstimated1RM = useCallback((week) => {
        const estimates = [];
        
        if (week.topSingle.weight && week.topSingle.actualReps && week.topSingle.actualRpe) {
          estimates.push(calculateEstimated1RM(week.topSingle.weight, week.topSingle.actualReps, week.topSingle.actualRpe));
        }
        
        if (week.backoff.weight && week.backoff.actualReps && week.backoff.actualRpe) {
          estimates.push(calculateEstimated1RM(week.backoff.weight, week.backoff.actualReps, week.backoff.actualRpe));
        }
        
        if (estimates.length === 0) return 0;
        
        if (estimates.length === 2) {
          return Math.round(((estimates[0] * 0.7) + (estimates[1] * 0.3)) * 2) / 2;
        }
        
        return estimates[0];
      }, [calculateEstimated1RM]);

      // Complete current block and start new one with progressed weights
      const completeBlock = () => {
        const blockData = {
          blockNumber: currentBlock,
          completedDate: new Date().toISOString(),
          lifts: {}
        };

        ['squat', 'bench', 'deadlift'].forEach(lift => {
          const currentMax = trainingData[lift].currentMax;
          
          const currentWeek1 = calculateWeight(currentMax, 6, 1);
          const currentWeek2 = calculateWeight(currentMax, 7, 1);
          const currentWeek3 = calculateWeight(currentMax, 8, 1);
          const currentWeek4 = calculateWeight(currentMax, 9, 1);
          
          const weeks = trainingData[lift].weeks;
          const performanceData = [];
          
          weeks.forEach((week, index) => {
            if (week.topSingle.weight && week.topSingle.actualReps && week.topSingle.actualRpe) {
              performanceData.push({
                week: index + 1,
                type: 'topSingle',
                targetRPE: week.topSingle.rpe,
                actualRPE: week.topSingle.actualRpe,
                rpeVariance: week.topSingle.actualRpe - week.topSingle.rpe
              });
            }
            
            if (week.backoff.weight && week.backoff.actualReps && week.backoff.actualRpe) {
              performanceData.push({
                week: index + 1,
                type: 'backoff',
                targetRPE: week.backoff.rpe,
                actualRPE: week.backoff.actualRpe,
                rpeVariance: week.backoff.actualRpe - week.backoff.rpe
              });
            }
          });
          
          let newTrainingMax;
          let avgRPEVariance = 0;
          
          if (performanceData.length > 0) {
            avgRPEVariance = performanceData.reduce((sum, data) => sum + data.rpeVariance, 0) / performanceData.length;
            
            const targetWeek1Weight = currentWeek2;
            const baseNewMax = Math.round((targetWeek1Weight / tuchschererChart[1][6]) / 2.5) * 2.5;
            
            // Realistic progression adjustments based on lift type
            let liftProgressionFactor = 1.0;
            switch(lift) {
              case 'squat':
                liftProgressionFactor = 1.02; // ~2-3kg progression when things go well
                break;
              case 'bench':
                liftProgressionFactor = 1.015; // ~1.5-2kg progression when things go well
                break;
              case 'deadlift':
                liftProgressionFactor = 1.025; // ~3-4kg progression when things go well
                break;
            }
            
            let adjustmentFactor = liftProgressionFactor;
            if (avgRPEVariance > 0.3) {
              // RPEs running high - reduce or maintain
              if (avgRPEVariance > 1.0) {
                adjustmentFactor = 0.95; // Deload by 5%
              } else if (avgRPEVariance > 0.7) {
                adjustmentFactor = 0.98; // Very small deload
              } else {
                adjustmentFactor = 1.0; // Maintain weight
              }
            } else if (avgRPEVariance < -0.3) {
              // RPEs running low - can push progression more
              const extraProgression = Math.abs(avgRPEVariance) * 0.01;
              adjustmentFactor = liftProgressionFactor + extraProgression;
            }
            
            newTrainingMax = Math.round((baseNewMax * adjustmentFactor) / 2.5) * 2.5;
            
            // Realistic safety bounds based on lift type
            let maxIncrease, maxDecrease;
            switch(lift) {
              case 'squat':
                maxIncrease = currentMax + 5; // Max 5kg increase per block
                maxDecrease = Math.max(currentMax - 7.5, currentMax * 0.9);
                break;
              case 'bench':
                maxIncrease = currentMax + 2.5; // Max 2.5kg increase per block  
                maxDecrease = Math.max(currentMax - 5, currentMax * 0.9);
                break;
              case 'deadlift':
                maxIncrease = currentMax + 7.5; // Max 7.5kg increase per block
                maxDecrease = Math.max(currentMax - 10, currentMax * 0.9);
                break;
              default:
                maxIncrease = currentMax + 2.5;
                maxDecrease = Math.max(currentMax - 5, currentMax * 0.9);
            }
            
            newTrainingMax = Math.max(maxDecrease, Math.min(maxIncrease, newTrainingMax));
            
          } else {
            // No performance data - very conservative progression based on lift
            let conservativeIncrease;
            switch(lift) {
              case 'squat':
                conservativeIncrease = 2.5;
                break;
              case 'bench':
                conservativeIncrease = 1.25; // Even smaller for bench
                break;
              case 'deadlift':
                conservativeIncrease = 2.5;
                break;
              default:
                conservativeIncrease = 1.25;
            }
            
            const targetWeek1Weight = currentWeek2;
            newTrainingMax = Math.round((targetWeek1Weight / tuchschererChart[1][6]) / 2.5) * 2.5;
            
            // Add small conservative increase
            newTrainingMax = Math.round((newTrainingMax + conservativeIncrease) / 2.5) * 2.5;
          }
          
          const newWeek1 = calculateWeight(newTrainingMax, 6, 1);
          const newWeek2 = calculateWeight(newTrainingMax, 7, 1);
          const newWeek3 = calculateWeight(newTrainingMax, 8, 1);
          const newWeek4 = calculateWeight(newTrainingMax, 9, 1);
          
          blockData.lifts[lift] = {
            oldMax: currentMax,
            newMax: newTrainingMax,
            progression: newTrainingMax - currentMax,
            avgRPEVariance: avgRPEVariance,
            performanceData: performanceData,
            oldWeights: {
              week1: currentWeek1,
              week2: currentWeek2,
              week3: currentWeek3, 
              week4: currentWeek4
            },
            newWeights: {
              week1: newWeek1,
              week2: newWeek2,
              week3: newWeek3,
              week4: newWeek4
            }
          };
        });

        setCompletedBlocks(prev => [...prev, blockData]);
        
        const newTrainingData = createInitialData();
        Object.keys(newTrainingData).forEach(lift => {
          newTrainingData[lift].currentMax = blockData.lifts[lift].newMax;
          newTrainingData[lift].weeks = newTrainingData[lift].weeks.map(week => ({
            ...week, 
            topSingle: {
              ...week.topSingle,
              weight: calculateWeight(blockData.lifts[lift].newMax, week.topSingle.rpe, 1)
            },
            backoff: {
              ...week.backoff,
              weight: calculateWeight(blockData.lifts[lift].newMax, week.backoff.rpe, week.backoff.reps)
            },
            notes: ''
          }));
        });
        
        setTrainingData(newTrainingData);
        setCurrentBlock(prev => prev + 1);
      };

      const resetProgram = () => {
        const freshData = createInitialData();
        setTrainingData(freshData);
        setCurrentBlock(1);
        setCompletedBlocks([]);
      };

      const updateCurrentMax = (lift, newMax) => {
        setTrainingData(prev => ({
          ...prev,
          [lift]: {
            ...prev[lift],
            currentMax: parseInt(newMax) || 0
          }
        }));
      };

      const updateWeight = (lift, weekIndex, exercise, field, newValue) => {
        setTrainingData(prev => ({
          ...prev,
          [lift]: {
            ...prev[lift],
            weeks: prev[lift].weeks.map((week, index) => 
              index === weekIndex 
                ? {
                    ...week,
                    [exercise]: {
                      ...week[exercise],
                      [field]: field === 'weight' ? (parseFloat(newValue) || 0) : (parseInt(newValue) || 0)
                    }
                  }
                : week
            )
          }
        }));
      };

      const updateNotes = (lift, weekIndex, newNotes) => {
        setTrainingData(prev => ({
          ...prev,
          [lift]: {
            ...prev[lift],
            weeks: prev[lift].weeks.map((week, index) => 
              index === weekIndex 
                ? { ...week, notes: newNotes }
                : week
            )
          }
        }));
      };

      const autoCalculateWeights = (lift) => {
        const currentMax = trainingData[lift].currentMax;
        setTrainingData(prev => ({
          ...prev,
          [lift]: {
            ...prev[lift],
            weeks: prev[lift].weeks.map(week => ({
              ...week,
              topSingle: {
                ...week.topSingle,
                weight: calculateWeight(currentMax, week.topSingle.rpe, 1)
              },
              backoff: {
                ...week.backoff,
                weight: calculateWeight(currentMax, week.backoff.rpe, week.backoff.reps)
              }
            }))
          }
        }));
      };

      const exportData = () => {
        const exportObj = {
          trainingData,
          currentBlock,
          completedBlocks,
          exportDate: new Date().toISOString(),
          programName: "Block Periodization Powerlifting Template"
        };
        
        const dataStr = JSON.stringify(exportObj, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `powerlifting-block-${currentBlock}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      const prepareChartData = () => {
        const chartData = [];
        
        completedBlocks.forEach((block) => {
          for (let weekNum = 1; weekNum <= 4; weekNum++) {
            chartData.push({
              week: `B${block.blockNumber}W${weekNum}`,
              blockNumber: block.blockNumber,
              weekNumber: weekNum,
              squat: weekNum === 4 ? block.lifts.squat.oldWeights?.week4 || null : null,
              bench: weekNum === 4 ? block.lifts.bench.oldWeights?.week4 || null : null,
              deadlift: weekNum === 4 ? block.lifts.deadlift.oldWeights?.week4 || null : null
            });
          }
        });
        
        for (let weekNum = 1; weekNum <= 4; weekNum++) {
          const weekData = { 
            week: `B${currentBlock}W${weekNum}`,
            blockNumber: currentBlock,
            weekNumber: weekNum
          };
          
          ['squat', 'bench', 'deadlift'].forEach(lift => {
            const week = trainingData[lift].weeks[weekNum - 1];
            const estimate = calculateWeeklyEstimated1RM(week);
            weekData[lift] = estimate > 0 ? estimate : null;
          });
          
          chartData.push(weekData);
        }
        
        return chartData;
      };

      const currentLiftData = trainingData[selectedLift];

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
          <div className="max-w-7xl mx-auto">
            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 sm:p-6 mb-6 border border-white/20">
              <div className="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-4">
                <div className="flex items-center gap-3">
                  <Dumbbell className="w-6 h-6 sm:w-8 sm:h-8 text-purple-400" />
                  <div>
                    <h1 className="text-2xl sm:text-3xl font-bold text-white">Block Periodization</h1>
                    <p className="text-sm sm:text-base text-purple-300">Block {currentBlock}</p>
                  </div>
                </div>
                <div className="flex flex-col sm:flex-row gap-2">
                  <button
                    onClick={exportData}
                    className="flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-3 sm:px-4 py-2 rounded-lg transition-colors text-xs sm:text-sm"
                  >
                    <Download className="w-3 h-3 sm:w-4 sm:h-4" />
                    Export
                  </button>
                  {Object.values(trainingData).some(lift => 
                    lift.weeks[3].topSingle.weight > 0 && lift.weeks[3].topSingle.actualRpe > 0
                  ) && (
                    <button
                      onClick={completeBlock}
                      className="flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white px-3 sm:px-4 py-2 rounded-lg transition-colors text-xs sm:text-sm"
                    >
                      Complete Block
                    </button>
                  )}
                  <button
                    onClick={resetProgram}
                    className="flex items-center justify-center gap-2 bg-red-600 hover:bg-red-700 text-white px-3 sm:px-4 py-2 rounded-lg transition-colors text-xs sm:text-sm"
                  >
                    Reset Program
                  </button>
                </div>
              </div>

              <div className="flex gap-1 sm:gap-2 mb-4 sm:mb-6">
                {[
                  { id: 'training', label: 'Training', icon: Dumbbell },
                  { id: 'deload', label: 'Recovery', icon: TrendingUp },
                  { id: 'history', label: 'History', icon: TrendingUp },
                  { id: 'chart', label: 'Progress', icon: TrendingUp }
                ].map(tab => {
                  const Icon = tab.icon;
                  return (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`flex items-center gap-2 px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${
                        activeTab === tab.id
                          ? 'bg-purple-600 text-white'
                          : 'bg-white/20 text-white hover:bg-white/30'
                      }`}
                    >
                      <Icon className="w-3 h-3 sm:w-4 sm:h-4" />
                      {tab.label}
                    </button>
                  );
                })}
              </div>

              {/* Deload Detection Alert - Show on training tab if needed */}
            {activeTab === 'training' && deloadAnalysis.needsDeload && (
              <div className={`rounded-2xl p-4 sm:p-6 mb-6 border ${
                deloadAnalysis.severity === 'severe' ? 'bg-red-500/20 border-red-400/50' :
                deloadAnalysis.severity === 'moderate' ? 'bg-orange-500/20 border-orange-400/50' :
                'bg-yellow-500/20 border-yellow-400/50'
              }`}>
                <div className="flex items-start gap-3">
                  <div className={`p-2 rounded-lg ${
                    deloadAnalysis.severity === 'severe' ? 'bg-red-500/30' :
                    deloadAnalysis.severity === 'moderate' ? 'bg-orange-500/30' :
                    'bg-yellow-500/30'
                  }`}>
                    <TrendingUp className={`w-5 h-5 ${
                      deloadAnalysis.severity === 'severe' ? 'text-red-400' :
                      deloadAnalysis.severity === 'moderate' ? 'text-orange-400' :
                      'text-yellow-400'
                    }`} />
                  </div>
                  <div className="flex-1">
                    <h3 className={`text-lg font-bold mb-2 ${
                      deloadAnalysis.severity === 'severe' ? 'text-red-400' :
                      deloadAnalysis.severity === 'moderate' ? 'text-orange-400' :
                      'text-yellow-400'
                    }`}>
                      {deloadAnalysis.severity === 'severe' ? '🛑 Deload Strongly Recommended' :
                       deloadAnalysis.severity === 'moderate' ? '⚠️ Consider a Deload' :
                       '📊 Recovery May Be Needed'}
                    </h3>
                    <div className="space-y-2 text-sm text-white/90">
                      <div>
                        <strong>Why:</strong>
                        <ul className="list-disc list-inside ml-2 mt-1">
                          {deloadAnalysis.reasons.map((reason, index) => (
                            <li key={index}>{reason}</li>
                          ))}
                        </ul>
                      </div>
                      <div>
                        <strong>Suggestions:</strong>
                        <ul className="list-disc list-inside ml-2 mt-1">
                          {deloadAnalysis.suggestions.map((suggestion, index) => (
                            <li key={index}>{suggestion}</li>
                          ))}
                        </ul>
                      </div>
                      <button
                        onClick={() => setActiveTab('deload')}
                        className={`mt-3 px-4 py-2 rounded-lg font-medium transition-colors ${
                          deloadAnalysis.severity === 'severe' ? 'bg-red-600 hover:bg-red-700' :
                          deloadAnalysis.severity === 'moderate' ? 'bg-orange-600 hover:bg-orange-700' :
                          'bg-yellow-600 hover:bg-yellow-700'
                        } text-white text-sm`}
                      >
                        View Recovery Plan →
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'training' && (
                <div className="flex gap-1 sm:gap-2">
                  {['squat', 'bench', 'deadlift'].map(lift => (
                    <button
                      key={lift}
                      onClick={() => setSelectedLift(lift)}
                      className={`px-3 sm:px-6 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${
                        selectedLift === lift
                          ? 'bg-purple-600 text-white'
                          : 'bg-white/20 text-white hover:bg-white/30'
                      }`}
                    >
                      {lift.charAt(0).toUpperCase() + lift.slice(1)}
                    </button>
                  ))}
                </div>
              )}
            </div>

            {activeTab === 'training' && (
              <>
                <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 sm:p-6 mb-6 border border-white/20">
                  <div className="flex flex-col sm:flex-row sm:items-center gap-4 mb-4">
                    <label className="text-white font-medium text-sm sm:text-base">
                      Starting {selectedLift.charAt(0).toUpperCase() + selectedLift.slice(1)} Max:
                    </label>
                    <div className="flex items-center gap-2">
                      <input
                        type="number"
                        value={currentLiftData.currentMax}
                        onChange={(e) => updateCurrentMax(selectedLift, e.target.value)}
                        className="bg-white/20 text-white placeholder-white/60 px-3 sm:px-4 py-2 rounded-lg w-20 sm:w-24 border border-white/30 focus:border-purple-400 focus:outline-none text-sm sm:text-base"
                        placeholder="140"
                      />
                      <span className="text-white text-sm sm:text-base">kg</span>
                      <button
                        onClick={() => autoCalculateWeights(selectedLift)}
                        className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-3 sm:px-4 py-2 rounded-lg transition-colors text-xs sm:text-sm"
                      >
                        <Calculator className="w-3 h-3 sm:w-4 sm:h-4" />
                        <span className="hidden sm:inline">Auto Calculate</span>
                        <span className="sm:hidden">Auto</span>
                      </button>
                    </div>
                  </div>
                  <p className="text-white/60 text-xs sm:text-sm">
                    Block {currentBlock}: Training max {currentLiftData.currentMax}kg. Next block will start at {calculateWeight(currentLiftData.currentMax, 7, 1)}kg (current Week 2 weight).
                  </p>
                </div>

                <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 sm:p-6 border border-white/20 overflow-x-auto">
                  <h2 className="text-xl sm:text-2xl font-bold text-white mb-2">
                    {selectedLift.charAt(0).toUpperCase() + selectedLift.slice(1)} Program - Block {currentBlock}
                  </h2>
                  <p className="text-white/60 text-xs sm:text-sm mb-4 sm:mb-6">
                    Complete all 4 weeks, then progress to the next block with updated training maxes
                  </p>
                  
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                    {currentLiftData.weeks.map((week, weekIndex) => {
                      const weeklyEstimate = calculateWeeklyEstimated1RM(week);
                      const topSingleEstimate = week.topSingle.weight && week.topSingle.actualReps && week.topSingle.actualRpe 
                        ? calculateEstimated1RM(week.topSingle.weight, week.topSingle.actualReps, week.topSingle.actualRpe)
                        : 0;
                      const suggestedBackoffWeight = calculateBackoffWeight(
                        week.topSingle.weight, 
                        week.topSingle.actualReps, 
                        week.topSingle.actualRpe, 
                        week.backoff.reps, 
                        week.backoff.rpe
                      );
                      
                      return (
                        <div key={weekIndex} className="bg-white/10 rounded-xl p-3 sm:p-4 border border-white/20">
                          <h3 className="text-lg sm:text-xl font-bold text-purple-300 mb-2 text-center">
                            Week {week.week}
                          </h3>
                          
                          {topSingleEstimate > 0 && (
                            <div className="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-lg p-2 sm:p-3 mb-3 sm:mb-4 text-center border border-yellow-400/30">
                              <div className="text-yellow-300 text-xs sm:text-sm font-medium">Estimated 1RM</div>
                              <div className="text-yellow-400 text-lg sm:text-xl font-bold">{topSingleEstimate} kg</div>
                              <div className="text-yellow-300/80 text-xs mt-1">Based on top single</div>
                            </div>
                          )}
                          
                          {weeklyEstimate > 0 && (
                            <div className="bg-green-500/20 rounded-lg p-2 mb-3 sm:mb-4 text-center border border-green-400/30">
                              <div className="text-green-300 text-xs sm:text-sm font-medium">Week Average</div>
                              <div className="text-green-400 text-sm sm:text-lg font-bold">{weeklyEstimate} kg</div>
                            </div>
                          )}

                          <div className="mb-4 sm:mb-6">
                            <h4 className="text-base sm:text-lg font-semibold text-white mb-2 sm:mb-3">Top Single</h4>
                            <div className="space-y-1 sm:space-y-2 text-sm sm:text-base">
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Target RPE:</span>
                                <span className="text-purple-300 font-bold">{week.topSingle.rpe}</span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Suggested:</span>
                                <span className="text-green-400 font-bold">
                                  {calculateWeight(currentLiftData.currentMax, week.topSingle.rpe, 1)} kg
                                </span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Weight:</span>
                                <input
                                  type="number"
                                  step="2.5"
                                  value={week.topSingle.weight || ''}
                                  onChange={(e) => updateWeight(selectedLift, weekIndex, 'topSingle', 'weight', e.target.value)}
                                  className="bg-white/20 text-white w-16 sm:w-20 px-1 sm:px-2 py-1 rounded border border-white/30 focus:border-purple-400 focus:outline-none text-center text-sm sm:text-base"
                                  placeholder="140"
                                />
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Reps:</span>
                                <input
                                  type="number"
                                  min="1"
                                  value={week.topSingle.actualReps || ''}
                                  onChange={(e) => updateWeight(selectedLift, weekIndex, 'topSingle', 'actualReps', e.target.value)}
                                  className="bg-white/20 text-white w-12 sm:w-16 px-1 sm:px-2 py-1 rounded border border-white/30 focus:border-purple-400 focus:outline-none text-center text-sm sm:text-base"
                                  placeholder="1"
                                />
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Actual RPE:</span>
                                <select
                                  value={week.topSingle.actualRpe || ''}
                                  onChange={(e) => updateWeight(selectedLift, weekIndex, 'topSingle', 'actualRpe', e.target.value)}
                                  className="bg-white/20 text-white w-16 sm:w-20 px-1 sm:px-2 py-1 rounded border border-white/30 focus:border-purple-400 focus:outline-none text-center text-xs sm:text-sm"
                                >
                                  <option value="" className="bg-slate-800">Select</option>
                                  <option value="6" className="bg-slate-800">RPE 6</option>
                                  <option value="7" className="bg-slate-800">RPE 7</option>
                                  <option value="8" className="bg-slate-800">RPE 8</option>
                                  <option value="9" className="bg-slate-800">RPE 9</option>
                                  <option value="10" className="bg-slate-800">RPE 10</option>
                                </select>
                              </div>
                              {week.topSingle.weight > 0 && week.topSingle.actualReps && week.topSingle.actualRpe && (
                                <div className="flex justify-between items-center bg-yellow-500/10 p-2 rounded border border-yellow-400/20 text-xs sm:text-sm">
                                  <span className="text-yellow-300 font-medium">→ Est. 1RM:</span>
                                  <span className="text-yellow-400 font-bold">
                                    {calculateEstimated1RM(week.topSingle.weight, week.topSingle.actualReps, week.topSingle.actualRpe)} kg
                                  </span>
                                </div>
                              )}
                            </div>
                          </div>

                          <div>
                            <h4 className="text-base sm:text-lg font-semibold text-white mb-2 sm:mb-3">Back-off Sets</h4>
                            <div className="space-y-1 sm:space-y-2 text-sm sm:text-base">
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Sets × Reps:</span>
                                <div className="flex gap-1">
                                  <input
                                    type="number"
                                    min="1"
                                    max="5"
                                    value={week.backoff.sets || ''}
                                    onChange={(e) => updateWeight(selectedLift, weekIndex, 'backoff', 'sets', e.target.value)}
                                    className="bg-white/20 text-white w-10 sm:w-12 px-1 py-1 rounded border border-white/30 focus:border-purple-400 focus:outline-none text-center text-xs sm:text-sm"
                                    placeholder="3"
                                  />
                                  <span className="text-white/80 text-xs sm:text-sm">×</span>
                                  <input
                                    type="number"
                                    min="1"
                                    max="10"
                                    value={week.backoff.reps || ''}
                                    onChange={(e) => updateWeight(selectedLift, weekIndex, 'backoff', 'reps', e.target.value)}
                                    className="bg-white/20 text-white w-10 sm:w-12 px-1 py-1 rounded border border-white/30 focus:border-purple-400 focus:outline-none text-center text-xs sm:text-sm"
                                    placeholder="5"
                                  />
                                </div>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Target RPE:</span>
                                <span className="text-purple-300 font-bold">{week.backoff.rpe}</span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Suggested:</span>
                                <span className="text-green-400 font-bold">
                                  {suggestedBackoffWeight > 0 
                                    ? `${suggestedBackoffWeight} kg` 
                                    : `${calculateWeight(currentLiftData.currentMax, week.backoff.rpe, week.backoff.reps)} kg`
                                }
                                </span>
                              </div>
                              {suggestedBackoffWeight > 0 && (
                                <div className="text-xs text-green-300/70 text-center mt-1">
                                  ↑ Based on top single estimate
                                </div>
                              )}
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Weight:</span>
                                <input
                                  type="number"
                                  step="0.5"
                                  value={week.backoff.weight || ''}
                                  onChange={(e) => updateWeight(selectedLift, weekIndex, 'backoff', 'weight', e.target.value)}
                                  className="bg-white/20 text-white w-16 sm:w-20 px-1 sm:px-2 py-1 rounded border border-white/30 focus:border-purple-400 focus:outline-none text-center text-sm sm:text-base"
                                  placeholder="120"
                                />
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Reps:</span>
                                <input
                                  type="number"
                                  min="1"
                                  value={week.backoff.actualReps || ''}
                                  onChange={(e) => updateWeight(selectedLift, weekIndex, 'backoff', 'actualReps', e.target.value)}
                                  className="bg-white/20 text-white w-12 sm:w-16 px-1 sm:px-2 py-1 rounded border border-white/30 focus:border-purple-400 focus:outline-none text-center text-sm sm:text-base"
                                  placeholder="5"
                                />
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-white/80">Actual RPE:</span>
                                <select
                                  value={week.backoff.actualRpe || ''}
                                  onChange={(e) => updateWeight(selectedLift, weekIndex, 'backoff', 'actualRpe', e.target.value)}
                                  className="bg-white/20 text-white w-16 sm:w-20 px-1 sm:px-2 py-1 rounded border border-white/30 focus:border-purple-400 focus:outline-none text-center text-xs sm:text-sm"
                                >
                                  <option value="" className="bg-slate-800">Select</option>
                                  <option value="6" className="bg-slate-800">RPE 6</option>
                                  <option value="7" className="bg-slate-800">RPE 7</option>
                                  <option value="8" className="bg-slate-800">RPE 8</option>
                                  <option value="9" className="bg-slate-800">RPE 9</option>
                                  <option value="10" className="bg-slate-800">RPE 10</option>
                                </select>
                              </div>
                              {week.backoff.weight > 0 && week.backoff.actualReps && week.backoff.actualRpe && (
                                <div className="flex justify-between items-center text-xs sm:text-sm">
                                  <span className="text-white/80">Est. 1RM:</span>
                                  <span className="text-yellow-400 font-bold">
                                    {calculateEstimated1RM(week.backoff.weight, week.backoff.actualReps, week.backoff.actualRpe)} kg
                                  </span>
                                </div>
                              )}
                            </div>
                          </div>

                          <div className="mt-4 sm:mt-6">
                            <h4 className="text-base sm:text-lg font-semibold text-white mb-2 sm:mb-3">Session Notes</h4>
                            <textarea
                              value={week.notes || ''}
                              onChange={(e) => updateNotes(selectedLift, weekIndex, e.target.value)}
                              placeholder="How did it feel? Technique notes, sleep, energy level, etc..."
                              className="w-full bg-white/20 text-white placeholder-white/60 px-2 sm:px-3 py-2 rounded-lg border border-white/30 focus:border-purple-400 focus:outline-none resize-none text-xs sm:text-sm"
                              rows="3"
                            />
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </>
            )}

            {activeTab === 'history' && (
              <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                <h2 className="text-2xl font-bold text-white mb-6">Block Progression History</h2>
                {completedBlocks.length === 0 ? (
                  <div className="text-center py-12">
                    <TrendingUp className="w-16 h-16 text-white/30 mx-auto mb-4" />
                    <p className="text-white/60 text-lg">No completed blocks yet</p>
                    <p className="text-white/40 text-sm mt-2">Complete your first block to see progression history here</p>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {completedBlocks.map((block, index) => (
                      <div key={index} className="bg-white/10 rounded-lg p-4 border border-white/20">
                        <h4 className="text-lg font-semibold text-purple-300 mb-2">Block {block.blockNumber}</h4>
                        <div className="space-y-2 text-sm">
                          {Object.entries(block.lifts).map(([lift, data]) => (
                            <div key={lift} className="space-y-1">
                              <div className="flex justify-between">
                                <span className="text-white/80 capitalize">{lift}:</span>
                                <span className={`font-medium ${data.progression >= 0 ? 'text-green-400' : 'text-orange-400'}`}>
                                  {data.oldMax}kg → {data.newMax}kg ({data.progression >= 0 ? '+' : ''}{data.progression}kg)
                                </span>
                              </div>
                              {data.avgRPEVariance !== undefined && (
                                <div className="text-xs pl-2">
                                  <span className="text-white/60">RPE Performance: </span>
                                  <span className={`font-medium ${
                                    Math.abs(data.avgRPEVariance) < 0.3 ? 'text-green-400' : 
                                    data.avgRPEVariance > 0 ? 'text-orange-400' : 'text-blue-400'
                                  }`}>
                                    {data.avgRPEVariance > 0 ? '+' : ''}{data.avgRPEVariance.toFixed(1)} RPE
                                  </span>
                                  <span className="text-white/50 ml-1">
                                    ({Math.abs(data.avgRPEVariance) < 0.3 ? 'On target' : 
                                      data.avgRPEVariance > 0 ? 'Running hard' : 'Running easy'})
                                  </span>
                                </div>
                              )}
                              {data.oldWeights && (
                                <div className="text-xs text-white/60 pl-2">
                                  Block {block.blockNumber}: {data.oldWeights.week1}→{data.oldWeights.week2}→{data.oldWeights.week3}→{data.oldWeights.week4}kg
                                </div>
                              )}
                              <div className="text-xs text-green-300/60 pl-2">
                                Block {block.blockNumber + 1}: {data.newWeights.week1}→{data.newWeights.week2}→{data.newWeights.week3}→{data.newWeights.week4}kg
                              </div>
                            </div>
                          ))}
                        </div>
                        <div className="text-xs text-white/60 mt-2">
                          Completed: {new Date(block.completedDate).toLocaleDateString()}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {activeTab === 'chart' && (
              <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 sm:p-6 border border-white/20">
                <div className="flex items-center gap-3 mb-4 sm:mb-6">
                  <TrendingUp className="w-5 h-5 sm:w-6 sm:h-6 text-purple-400" />
                  <h3 className="text-lg sm:text-xl font-bold text-white">Strength Progression</h3>
                </div>
                
                <div className="h-64 sm:h-80">
                  <ResponsiveContainer width="100%" height="100%">
                    <LineChart data={prepareChartData()}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#ffffff20" />
                      <XAxis 
                        dataKey="week" 
                        stroke="#ffffff80"
                        fontSize={10}
                        interval={0}
                        angle={-45}
                        textAnchor="end"
                        height={60}
                      />
                      <YAxis 
                        stroke="#ffffff80"
                        fontSize={10}
                        label={{ value: 'Weight (kg)', angle: -90, position: 'insideLeft', style: { textAnchor: 'middle', fill: '#ffffff80' } }}
                      />
                      <Tooltip 
                        contentStyle={{ 
                          backgroundColor: '#1e293b', 
                          border: '1px solid #475569',
                          borderRadius: '8px',
                          color: '#ffffff',
                          fontSize: '12px'
                        }}
                        formatter={(value, name) => [
                          value ? `${value} kg` : 'No data',
                          name.charAt(0).toUpperCase() + name.slice(1)
                        ]}
                      />
                      <Legend 
                        wrapperStyle={{ color: '#ffffff', fontSize: '12px' }}
                      />
                      <Line 
                        type="monotone" 
                        dataKey="squat" 
                        stroke="#8b5cf6" 
                        strokeWidth={2}
                        dot={{ fill: '#8b5cf6', strokeWidth: 2, r: 3 }}
                        connectNulls={false}
                        name="Squat"
                      />
                      <Line 
                        type="monotone" 
                        dataKey="bench" 
                        stroke="#06d6a0" 
                        strokeWidth={2}
                        dot={{ fill: '#06d6a0', strokeWidth: 2, r: 3 }}
                        connectNulls={false}
                        name="Bench"
                      />
                      <Line 
                        type="monotone" 
                        dataKey="deadlift" 
                        stroke="#f72585" 
                        strokeWidth={2}
                        dot={{ fill: '#f72585', strokeWidth: 2, r: 3 }}
                        connectNulls={false}
                        name="Deadlift"
                      />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
                
                <div className="mt-4 text-xs sm:text-sm text-white/60">
                  <p>📈 Chart shows estimated 1RM progression across all completed blocks and current training</p>
                  <p>💡 B1W1 = Block 1 Week 1, etc. Your next block Week 1 will start at previous block Week 2 weights</p>
                </div>
              </div>
            )}

            {/* RPE Reference - Only show on training tab */}
            {activeTab === 'training' && (
              <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 sm:p-6 mt-6 border border-white/20">
                <h3 className="text-lg sm:text-xl font-bold text-white mb-4">RPE Chart (% of 1RM)</h3>
                <div className="overflow-x-auto">
                  <table className="w-full text-xs sm:text-sm">
                    <thead>
                      <tr className="border-b border-white/20">
                        <th className="text-white/80 p-1 sm:p-2 text-left">Reps</th>
                        {[6, 7, 8, 9, 10].map(rpe => (
                          <th key={rpe} className="text-purple-300 p-1 sm:p-2 text-center">RPE {rpe}</th>
                        ))}
                      </tr>
                    </thead>
                    <tbody>
                      {[1, 2, 3, 4, 5].map(reps => (
                        <tr key={reps} className="border-b border-white/10">
                          <td className="text-white font-medium p-1 sm:p-2">{reps}</td>
                          {[6, 7, 8, 9, 10].map(rpe => (
                            <td key={rpe} className="text-white/80 p-1 sm:p-2 text-center">
                              {Math.round(tuchschererChart[reps][rpe] * 100)}%
                            </td>
                          ))}
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {/* Block Periodization Guide - Only show on training tab */}
            {activeTab === 'training' && (
              <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 sm:p-6 mt-6 border border-white/20">
                <h3 className="text-lg sm:text-xl font-bold text-white mb-4">Block Periodization Guide</h3>
                <div className="text-white/80 space-y-2 text-xs sm:text-sm">
                  <p><strong>🔄 How Block Periodization Works:</strong></p>
                  <p>1. Complete a 4-week block (RPE 6→7→8→9 progression)</p>
                  <p>2. After Week 4, click <strong>"Complete Block"</strong> to auto-progress</p>
                  <p>3. App adjusts your training max based on RPE performance</p>
                  <p>4. <strong>Next block Week 1 ≈ Previous block Week 2 weights</strong> (if RPEs on target)</p>
                  <p>5. Repeat the cycle for continuous progression</p>
                  <p><strong>📊 Smart Autoregulation:</strong></p>
                  <p>• RPEs on target → Normal progression</p>
                  <p>• RPEs running high → Reduced progression or deload</p>
                  <p>• RPEs running low → Increased progression</p>
                  <p>💡 <strong>This is exactly how elite powerlifters periodize</strong> - responsive progression based on actual performance</p>
                </div>
              </div>
            )}

            {/* Deload Tab Content */}
            {activeTab === 'deload' && (
              <div className="bg-white/10 backdrop-blur-md rounded-2xl p-4 sm:p-6 border border-white/20">
                <div className="flex items-center gap-3 mb-4 sm:mb-6">
                  <TrendingUp className="w-5 h-5 sm:w-6 sm:h-6 text-green-400" />
                  <h3 className="text-lg sm:text-xl font-bold text-white">Recovery & Deload Planning</h3>
                </div>
                
                {deloadAnalysis.needsDeload ? (
                  <div className="space-y-6">
                    <div className={`rounded-xl p-4 sm:p-6 border ${
                      deloadAnalysis.severity === 'severe' ? 'bg-red-500/20 border-red-400/50' :
                      deloadAnalysis.severity === 'moderate' ? 'bg-orange-500/20 border-orange-400/50' :
                      'bg-yellow-500/20 border-yellow-400/50'
                    }`}>
                      <h4 className={`text-lg font-bold mb-3 ${
                        deloadAnalysis.severity === 'severe' ? 'text-red-400' :
                        deloadAnalysis.severity === 'moderate' ? 'text-orange-400' :
                        'text-yellow-400'
                      }`}>
                        {deloadAnalysis.severity === 'severe' ? '🛑 Immediate Deload Required' :
                         deloadAnalysis.severity === 'moderate' ? '⚠️ Deload Recommended' :
                         '📊 Light Recovery Suggested'}
                      </h4>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                          <h5 className="text-white font-semibold mb-2">Affected Lifts:</h5>
                          <ul className="list-disc list-inside text-white/80 text-sm space-y-1">
                            {deloadAnalysis.affectedLifts.map((lift, index) => (
                              <li key={index} className="capitalize">{lift}</li>
                            ))}
                          </ul>
                        </div>
                        
                        <div>
                          <h5 className="text-white font-semibold mb-2">Key Issues:</h5>
                          <ul className="list-disc list-inside text-white/80 text-sm space-y-1">
                            {deloadAnalysis.reasons.map((reason, index) => (
                              <li key={index}>{reason}</li>
                            ))}
                          </ul>
                        </div>
                      </div>
                    </div>

                    <div className="bg-green-500/20 rounded-xl p-4 sm:p-6 border border-green-400/50">
                      <h4 className="text-lg font-bold text-green-400 mb-3">📋 Recommended Recovery Protocol</h4>
                      <div className="space-y-3">
                        {deloadAnalysis.suggestions.map((suggestion, index) => (
                          <div key={index} className="flex items-start gap-3">
                            <span className="text-green-400 font-bold text-sm">{index + 1}.</span>
                            <span className="text-white/90 text-sm">{suggestion}</span>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="bg-blue-500/20 rounded-xl p-4 sm:p-6 border border-blue-400/50">
                      <h4 className="text-lg font-bold text-blue-400 mb-3">🎯 Suggested Deload Weights</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {['squat', 'bench', 'deadlift'].map(lift => {
                          const currentMax = trainingData[lift].currentMax;
                          const deloadPercentage = deloadAnalysis.severity === 'severe' ? 0.6 : 
                                                 deloadAnalysis.severity === 'moderate' ? 0.7 : 0.85;
                          const deloadWeight = Math.round((currentMax * deloadPercentage) / 2.5) * 2.5;
                          
                          return (
                            <div key={lift} className="text-center">
                              <h5 className="text-white font-semibold mb-2 capitalize">{lift}</h5>
                              <div className="text-2xl font-bold text-blue-400">{deloadWeight}kg</div>
                              <div className="text-xs text-white/60">
                                ({Math.round(deloadPercentage * 100)}% of {currentMax}kg)
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-12">
                    <div className="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                      <TrendingUp className="w-8 h-8 text-green-400" />
                    </div>
                    <h4 className="text-xl font-bold text-green-400 mb-2">✅ Recovery Status: Good</h4>
                    <p className="text-white/80 mb-4">Your RPE performance indicates you're recovering well from training</p>
                    <div className="bg-green-500/10 rounded-lg p-4 border border-green-400/30 max-w-md mx-auto">
                      <p className="text-green-300 text-sm">
                        💪 Keep following your current program. Consider a deload every 4-6 blocks or when RPEs start consistently running high.
                      </p>
                    </div>
                  </div>
                )}
                
                <div className="mt-6 bg-white/5 rounded-xl p-4 border border-white/10">
                  <h4 className="text-white font-semibold mb-3">💡 General Recovery Tips</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-white/80">
                    <div>
                      <h5 className="text-white font-medium mb-2">Sleep & Recovery</h5>
                      <ul className="list-disc list-inside space-y-1">
                        <li>Aim for 7-9 hours of quality sleep</li>
                        <li>Maintain consistent sleep schedule</li>
                        <li>Limit screens before bed</li>
                      </ul>
                    </div>
                    <div>
                      <h5 className="text-white font-medium mb-2">Nutrition & Hydration</h5>
                      <ul className="list-disc list-inside space-y-1">
                        <li>Adequate protein intake (0.8-1g/lb bodyweight)</li>
                        <li>Stay well hydrated throughout the day</li>
                        <li>Don't drastically under-eat during heavy training</li>
                      </ul>
                    </div>
                    <div>
                      <h5 className="text-white font-medium mb-2">Stress Management</h5>
                      <ul className="list-disc list-inside space-y-1">
                        <li>Manage work and life stress</li>
                        <li>Take rest days seriously</li>
                        <li>Consider meditation or relaxation techniques</li>
                      </ul>
                    </div>
                    <div>
                      <h5 className="text-white font-medium mb-2">Active Recovery</h5>
                      <ul className="list-disc list-inside space-y-1">
                        <li>Light cardio on rest days</li>
                        <li>Mobility and stretching work</li>
                        <li>Massage or foam rolling</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    // Render the component
    ReactDOM.render(React.createElement(PowerliftingApp), document.getElementById('root'));

  </script>
</body>
</html>
